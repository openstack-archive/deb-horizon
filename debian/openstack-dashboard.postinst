#!/bin/sh
set -e

if [ "$1" = "configure" ] ; then
	adduser --system \
		--home /var/lib/horizon \
		--quiet \
		--disabled-password \
		--group horizon

	mkdir -p /var/lib/openstack-dashboard/static/js
	mkdir -p /var/lib/openstack-dashboard/static/css
	mkdir -p /var/lib/openstack-dashboard/secret-key
	chown www-data:www-data /var/lib/openstack-dashboard/static
	chown www-data:www-data /var/lib/openstack-dashboard/static/css
	chown www-data:www-data /var/lib/openstack-dashboard/static/js
	chown www-data:www-data /var/lib/openstack-dashboard/secret-key

    # Compress the JS and CSS with python-compressor and python-lesscpy
	/usr/share/openstack-dashboard/manage.py compress --force
	rm /var/lib/openstack-dashboard/secret-key/.secret_key_store
	chown -R www-data /var/lib/openstack-dashboard/secret-key
fi

if [ "$1" = "triggered" ] ; then
	/usr/share/openstack-dashboard/manage.py compress --force
	rm /var/lib/openstack-dashboard/secret-key/.secret_key_store
	chown -R www-data /var/lib/openstack-dashboard/secret-key
fi

#DEBHELPER#

exit 0
